\section{Generic Evaluation Proposal}
\label{sec:proposal}
As seen in Section~\ref{sec:EvaluationResults}: Evaluation Results, when evaluating web application firewalls with firewall evasion techniques, an iterative approach to developing payloads seems to be a good solution. If the evaluation is done from the perspective of an firewall administrator, access to logs is possible. Using the approach from Section~\ref{sec:evaluation}: Evaluation, bypassing payloads can be developed quickly if the log message and specific matched part of the payload is known. Once a bypassing payload has been successfully developed and tested against the firewall that is to be evaluated, knowledge about possible loopholes is gained and counter measures can be implemented. As stated in Section~\ref{sec:evalinterpretation}: Interpretation of Evaluation Results, even if there is no immediate possibility to implement rules based on the discovered bypass, the knowledge gained can be valuable. Based on what was described in Section~\ref{sec:evaluation}: Evaluation and the results thereof (Section~\ref{sec:EvaluationResults}: Evaluation Results), the following generic evaluation approach is proposed.

\subsection{Proposed step 1: Gathering evasion techniques}
As a first step, research into specific evasion techniques covering the used technologies by a web application that is to be protected by the evaluated firewall is conducted. If the web application uses a NoSQL database, evasion techniques specific to obscuring SQL-injection payloads are ignored in favor of evasion techniques specific to obscuring NoSQL-injection payloads. As detailed in Section~\ref{sec:varioustech}: Various Payloads, some evasion techniques are not specific to any kind of (injection-) attack and can be considered more broadly.

\subsection{Proposed step 2: Single iteration evaluation}
After evasasion techniques to be evaluated against the tested firewall have been chosen, they are used to create proof-of-concept payloads in a separate fashion. Every evasion technique is evaluated against the firewall configuration by itself. The crafted payloads are subsequently tested against the firewall while analyzing the firewall log to take note on which payloads show potential to be used within a multi iteration approach. Potential can be classified in 3 different classes: unsuable, semi-usable and full potential. Only semi-usable and full potential evasion techniques are used within the following multi iteration approach.

Taking the results from Section~\ref{sec:casealternationevaluation}: Case Alternation as an example: The log file created by the ModSecurity firewall shows that this evasion technique is to be classified as unusable. When sending a request with a proof-of-concept payload, the log reveals that the regex rule used to filter out the payload is configured to ignore case. As such, this techniques has no effect on any payload sent.

Taking the results from Section~\ref{sec:taggedtemplateliteralsevaluation} as another example: While the evasion technique can be used to send a bypassing proof-of-concept payload in the form of \verb|alert`XSS`| towards the web application, by the way Tagged Template Literals are implemented in JavaScript, some payload limitations incur when using this technique. In the example, because of using Tagged Template Literals, the function \verb|alert()| can no longer be called with a variable given as a parameter. Payload limitations incurred by using Tagged Template Literals are further discussed in Section~\ref{sec:payloadlimitations}: Payload Limitations {\color{red}TODO: wenn section payload limitations removed wird, hier auf firewall evasion fundamentals section hinweisen}. Considering incurred payload limitations, using Tagged Template Literals as an evasion technique is classified semi-usable.

Taking the results from Section~\ref{sec:aurebeshevaluation}: Aurebesh as a third example: Using the Aurebesh evasion technique, the proof-of-concept payload \verb|prompt(1,2)| can be sent without any incurring limitations. As such, using Aurebesh as an evasion technique is classified with full potential.

\subsection{Proposed step 3: Multi iteration evaluation}
\label{sec:genericproposalstep3}
Once evasion techniques showing potential have been discovered by using the proof-of-concept payloads crafted in Step 2, multi iteration evaluation can begin. Initially, payloads of interest are researched or crafted. To keep it relevant, these payloads need to have possible malicious influence on the web application that is to be protected by the evaluated firewall. As in the proposed step 1, the technologies used by the web application are considered when deciding on payload variants. Taking a banking web application using JavaScript in the Frontend as an example, Cross-site-scripting payloads are of interest. Once a payload that could negatively influence the web application is found, iteratively applying the noted evasion techniques from proposed step 2 can begin. Multi iteration evaluation is started by sending the plain, not-yet-obscured payload towards the web application and subsequently analyzing the firewall log. As stated in Section~\ref{sec:evaluation}: Evaluation, each iteration begins with analyzing the firewall log of filtered/rejected requests for matched parts of the payload. Once these parts have been identified, an evasion technique classified as usable in proposed step 2 is used to obscure these parts of the payload. During application of an evasion technique to the payload, the payload needs to be kept valid. The validity of the payload is tested at each iteration. Once the payload has been obscured, it is sent towards to web application. Subsequently checking the firewall logs marks the beginning of the next iteration. If at any iteration the payload passes the filter of the firewall, a new bypassing payload has been discovered.

\subsection{Proposed step 4: Implementing new firewall rules}
With the found bypassing payload from proposed step 3 and the knowledge about the evasion techniques used, new rules to extend the firewall configuration can be established. The crafting of new rules at this point is based on the gained knowledge. Knowing the bypassing payload as well as all applied evasion techniques, it is possible to craft a rule that detects at least one of the applied evasion techniques and therefore can cause the firewall to block the obscured payload. 
Taking the evaluation result of Section~\ref{sec:funconstrconbypass}: Function Constructor + String Concatenation as an example: Rules can be implemented that detect the usage of the function constructor as used in Section~\ref{sec:funconstrconbypass}. This blocks the request as payloads using the mentioned syntax of the bypassing payloads will be detected once this rule is implemented. This specific example is further detailed in the rule proposal under Section~\ref{sec:rulespropfunctionconstructor}: Function Constructor (Results).

Once rules for a specific payload have been developed and implemented, these rules are reflected on the used evasion techniques. Some evasion techniques allow for mutiple vectors to create bypassing payloads. The coverage provided by the newly implemented rules is assessed and potentially additionally found vectors for bypassing payloads are noted down to be used in the next evaluation step. 
\subsection{Continuing the Evaluation}
Finally, the new rules are tested against the found bypassing payloads to verify their detection. After verifying the rules, either the evaluation comes to an end or is continued at the initial phase of Section~\ref{sec:genericproposalstep3}: Proposed step 3: Multi iteration evaluation. If additional vectors for bypassing payloads have been found during the previous step, these are handled first. Handling these first allows to focus on one evasion technique at a time.

\subsection{Assessment}

Especially during multi-iteration-evaluation, there are many possible evasion technique combinations. If the evaluation is done manually, the subjectively most promising technique combinations can be used. Should this not yield expected results, a fallback on evaluating using any possible combination is possible.

{\color{red} TODO: hinzufügen: was sind die vorteile dieser evaluations technik?  \\
schneller und mehr bypassing payloads im vergleich zu blackbox testing durch analyse der logs in jedem schritt \\
dabei aber ähnlicher ansatz wie ein angreifer: research welche eva techniken es gibt und die dann anwenden \\
dieser ansatz gibt dann insight into performance against targeted requests \\
blacklist-regeln können so schritt für schritt im hinblick auf die web applikation verfeinert werden \\
}


{\color{red} TODO: hinzufügen: was sind die nachteile dieser evaluations technik? \\
risiko, dass evasions techniken übersehen werden \\
risiko, dass mögliche malicious payloads übersehen werden \\
risiko, dass einzelne technologien auf die die web app aufbaut vergessen werden \\
aber: diese risiken gibt es bei einem automatischen scan auch \\
}

{\color{red} TODO: hinzufügen: überleitung zu conclusion }
